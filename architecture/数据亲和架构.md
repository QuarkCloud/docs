#### 数据亲和架构

###### 1.  数据和算法
在软件的发展历史上，从最初的算法和数据捆绑在一起，到现在的算法和数据独立分开，以及现在百花齐放的数据存储技术，这是一种技术上的进步。算法在不同场景表现出来的多样性，以及数据规格的标准化，推动了整个软件技术在各种各样的场景的业务，最具代表性的是数据库技术的发展。

###### 2.  数据和状态
数据与时间相关，而呈现出不同的变化，谓之为状态。当程序迁移到新节点启动后，状态必须能够恢复到迁移之前的状态。通常的做法是在其他地方存储状态数据，将程序和状态数据分离。这样迁移程序，就不会导致状态丢失。但是这种做法，又引入了网络问题。因此大部分状态相关的服务还是将这些状态数据放入到本地，自己管理，或者强制改造成状态无关的服务。

###### 3.  数据和时间
当数据随着时间累积时，会庞大到难以在网络中迁移的程度。另一方面，数据的变化很快时，数据迁移会造成一致性问题。网络瓶颈，加大了时间对数据迁移的影响。

###### 4.  什么是数据亲和架构
数据亲和架构解决程序和数据的跟随问题，数据总是出现在程序需要它的地方，在最短的时间出现。对于程序来说，不需要考虑管理这些数据，也不需要专门提供访问接口。

###### 5.  如何处理历史数据
历史数据的难度在于量大。可以想象一个场景，读取某支股票的历史成交笔数，要从远程节点读取所有成交记录到本地，然后再进行统计。这个解决方案对网络流量冲击大，大家都知道这是不可取的，而访问端仅仅只需要一个统计值而已。如果将统计程序和数据部署在一起，那么就简单多了。事实上，数据库的SQL接口就是这样的结构。
对于海量数据，移动数据困难，那么就移动程序好了。数据亲和架构，要改变迁移程序时无视数据特性的状况，将程序靠近数据，降低网络负荷。

###### 6.  如何处理状态数据
因为要在本地管理状态数据，导致状态相关的服务，也难以在节点间迁移。数据亲和架构在该服务同一节点建立缓存，程序通过进程间通讯的通道访问这些数据，在性能上没有多少损失。而程序本身由于没有管理这些数据，成为事实上的，状态无关服务，迁移不成为问题。
另外一个方面，状态变迁的数据，也就是日志数据。基于日志数据的重演，可以确保状态的正确性，而状态日志的迁移，可以等价于历史上静态数据加上最后一段时间内的动态数据的迁移。状态数据的迁移，就转换为静态数据的重演和一段时间内动态数据的迁移。这个解决方案对网络冲击要小得多。
只要我们在其他节点，建立一个日志数据存储，在缓存中的状态被改变时，同时向日志数据存储发送一条变更日志，就能很好的实现状态数据的迁移。

