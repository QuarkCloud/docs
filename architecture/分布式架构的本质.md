#### 分布式架构

分布式架构的本质是计算本地化。它将一个庞大的系统分割成多个弱相关性的子系统，以此为基础，水平扩展。

虽然大多数分布式系统，都会承认这个理念，但在实践中，却陷入大集中，小分布的怪圈。比如分布式数据库，分布式存储，分布式缓存，诸如此类。对于子系统本来说，确实是分布式无疑，但是对于外部系统来说，这些分布式系统仍然被限制在集中的某些节点中。

分布式架构的核心价值，是为了解决网络瓶颈。如果我们假设节点之间的网络传输速率和带宽与本机无异，这是大规模集群的理念，那么分布式架构只会增加系统复杂度，而失去意义。如果节点需要计算的指令和数据都能从本地获取或者推演出来，那么分布式架构就能规避网络瓶颈，而发挥强大的计算能力。但事实上，这样的场景不具备普适性。

网络瓶颈之所以不可避免，这是因为：

1.  CPU的计算方式是假设所有需要的数据，都在缓存中。如果没有，就发出缺页指令，等待外部加载。如此一来，CPU对数据的真实依赖就被忽略，整个计算节点，从设计上来说是独立的，因此可以无限水平扩展。
2.  内存和磁盘存储在设计上也是如此，他们只管理到达本地的数据，至于数据来源于何处，以及怎么获取，就不是他们所关心的。

网络传输管理的是，数据从一个端到达另外一个端的传输资源。多个端通常都要共享一个传输通道，比如网卡，比如交换机。当多个节点同时爆发传输请求时，网络拥塞就会发生，并可能引发雪崩。

网络瓶颈的一个极端例子，就是跨数据中心。我们显然都会明白，如果一个计算要从另外一个数据中心读取数据，那么延迟比本地读取要大的多。再简单一点的例子，就是缓存。因为磁盘的访问数据要慢，因此热点数据尽量缓存到高速的主存中。
我们可以从一些著名的分布式文件系统中看到这样的一个细节。这些系统需要配置或者自动侦测存储节点是否在一个机柜中。显然本机柜进行文件恢复的代价，要小于跨机柜，因为跨机柜的传输带宽要小于机柜内部的带宽。


